<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Tracker & Invoice Generator</title>
    <!-- Include Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Include date-fns for date manipulation -->
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        /* Apple-like Design System */
        :root {
            /* Light mode colors */
            --background-color: #f5f5f7;
            --card-background: #ffffff;
            --primary-text: #1d1d1f;
            --secondary-text: #86868b;
            --accent-color: #0071e3;
            --accent-hover: #0077ed;
            --border-color: #d2d2d7;
            --error-color: #ff3b30;
            --success-color: #34c759;
            --warning-color: #ff9500;
            --input-background: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --card-shadow: 0 2px 8px var(--shadow-color);
            
            /* Fonts */
            --system-font: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            
            /* Sizes */
            --border-radius-small: 8px;
            --border-radius-medium: 12px;
            --border-radius-large: 16px;
            
            /* Transitions */
            --transition-speed: 0.2s;
        }
        
        body {
            font-family: var(--system-font);
            line-height: 1.5;
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--primary-text);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        h1, h2, h3 {
            font-weight: 600;
            letter-spacing: -0.01em;
            color: var(--primary-text);
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 24px;
        }
        
        h2 {
            font-size: 24px;
            margin-bottom: 16px;
        }
        
        h3 {
            font-size: 18px;
            margin-bottom: 12px;
        }
        
        label {
            display: block;
            margin: 10px 0 5px;
            font-size: 14px;
            font-weight: 500;
            color: var(--secondary-text);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-small);
            font-family: var(--system-font);
            font-size: 15px;
            background-color: var(--input-background);
            color: var(--primary-text);
            transition: all var(--transition-speed) ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }
        
        button {
            background-color: var(--accent-color);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            font-family: var(--system-font);
            font-weight: 500;
            font-size: 15px;
            transition: all var(--transition-speed) ease;
        }
        
        button:hover {
            background-color: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 20px 0;
            background-color: var(--card-background);
            border-radius: var(--border-radius-medium);
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }
        
        th, td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        th {
            background-color: var(--card-background);
            font-weight: 600;
            color: var(--secondary-text);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        tbody tr:last-child td {
            border-bottom: none;
        }
        
        tbody tr:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }
        
        .invoice {
            background-color: var(--card-background);
            border-radius: var(--border-radius-medium);
            padding: 24px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .summary {
            margin-top: 20px;
            padding: 16px;
            background-color: var(--card-background);
            border-radius: var(--border-radius-small);
            box-shadow: var(--card-shadow);
        }
        
        .delete-btn {
            background-color: var(--error-color);
            padding: 8px 12px;
            font-size: 13px;
        }
        
        .delete-btn:hover {
            background-color: #ff291f;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: var(--border-radius-small);
            background-color: var(--accent-color);
            color: white;
            box-shadow: var(--card-shadow);
            z-index: 1000;
            transition: opacity 0.3s ease;
        }

        .notification.warning {
            background-color: var(--warning-color);
        }

        .notification button {
            margin-left: 8px;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .notification .confirm-btn {
            background-color: var(--error-color);
            color: #fff;
        }

        .notification .cancel-btn {
            background-color: var(--card-background);
            color: var(--primary-text);
        }
        
        .file-operations, .filter-section, .timer-container, .expense-section, .time-entry {
            margin: 20px 0;
            padding: 24px;
            background-color: var(--card-background);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--card-shadow);
        }
        
        .blue-btn {
            background-color: var(--accent-color);
        }
        
        .blue-btn:hover {
            background-color: var(--accent-hover);
        }
        .dashboard {
            margin-top: 30px;
            padding: 24px;
            background-color: var(--card-background);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--card-shadow);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
            padding: 20px;
            background-color: var(--card-background);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--card-shadow);
        }
        
        .chart-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .chart-column {
            flex: 1;
            min-width: 300px;
        }
        
        .tabs {
            display: flex;
            overflow: hidden;
            background-color: var(--card-background);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--card-shadow);
            margin-bottom: 24px;
        }
        
        .tab-button {
            background-color: transparent;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 16px 24px;
            transition: all var(--transition-speed) ease;
            color: var(--secondary-text);
            margin: 0;
            border-radius: 0;
            font-weight: 500;
            position: relative;
        }
        
        .tab-button:hover {
            background-color: rgba(0, 0, 0, 0.03);
            color: var(--primary-text);
        }
        
        .tab-button.active {
            color: var(--accent-color);
            font-weight: 600;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--accent-color);
        }
        
        .tab-content {
            display: none;
            padding: 0;
            background-color: transparent;
        }
        .tag {
            display: inline-block;
            padding: 4px 10px;
            background-color: rgba(0, 113, 227, 0.1);
            border-radius: 16px;
            margin-right: 8px;
            font-size: 13px;
            font-weight: 500;
            color: var(--accent-color);
        }
        
        .project-tag {
            background-color: rgba(52, 199, 89, 0.1);
            color: var(--success-color);
        }
        
        .client-tag {
            background-color: rgba(255, 149, 0, 0.1);
            color: var(--warning-color);
        }
        
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .timer-display {
            font-size: 48px;
            font-weight: 300;
            margin: 24px 0;
            letter-spacing: -0.02em;
            color: var(--primary-text);
            text-align: center;
            font-variant-numeric: tabular-nums;
        }
        
        .recurring-entry {
            background-color: rgba(0, 113, 227, 0.05);
            padding: 16px;
            margin: 8px 0;
            border-radius: var(--border-radius-small);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all var(--transition-speed) ease;
        }
        
        .recurring-entry:hover {
            background-color: rgba(0, 113, 227, 0.1);
            transform: translateY(-1px);
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        
        #dark-mode-toggle {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--card-background);
            color: var(--primary-text);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            border: none;
            box-shadow: var(--card-shadow);
            font-size: 20px;
            transition: all var(--transition-speed) ease;
        }
        
        #dark-mode-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px var(--shadow-color);
        }
        
        /* Dark mode styles */
        .dark-mode {
            --background-color: #000;
            --card-background: #1c1c1e;
            --primary-text: #f5f5f7;
            --secondary-text: #86868b;
            --border-color: #38383a;
            --input-background: #2c2c2e;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }
        
        .dark-mode .tab-button.active {
            color: #0a84ff;
        }
        
        .dark-mode .tab-button.active::after {
            background-color: #0a84ff;
        }
        
        .dark-mode .tab-button:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode .stats-value {
            color: #0a84ff;
        }
        
        .dark-mode #dark-mode-toggle {
            background-color: #1c1c1e;
            color: #f5f5f7;
        }
        
        .dark-mode .tag {
            color: #0a84ff;
            background-color: rgba(10, 132, 255, 0.2);
        }
        
        .dark-mode .project-tag {
            color: #30d158;
            background-color: rgba(48, 209, 88, 0.2);
        }
        
        .dark-mode .client-tag {
            color: #ff9f0a;
            background-color: rgba(255, 159, 10, 0.2);
        }
        
        /* Stats cards */
        .stats-card {
            background-color: var(--card-background);
            border-radius: var(--border-radius-medium);
            padding: 20px;
            margin: 10px 0;
            box-shadow: var(--card-shadow);
            transition: all var(--transition-speed) ease;
        }
        
        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }
        
        .stats-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .stats-card {
            flex: 1;
            min-width: 200px;
            text-align: center;
        }
        
        .stats-value {
            font-size: 32px;
            font-weight: 600;
            margin: 12px 0;
            color: var(--accent-color);
            letter-spacing: -0.02em;
        }
        
        .stats-label {
            color: var(--secondary-text);
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        @media print {
            button, .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <h1>Time Tracker & Invoice Generator</h1>
    
    <!-- Tab Navigation -->
    <div class="tabs">
        <button class="tab-button active" onclick="openTab(event, 'time-tracking-tab')">Time Tracking</button>
        <button class="tab-button" onclick="openTab(event, 'dashboard-tab')">Dashboard</button>
        <button class="tab-button" onclick="openTab(event, 'invoice-tab')">Invoices</button>
        <button class="tab-button" onclick="openTab(event, 'reports-tab')">Reports</button>
        <button class="tab-button" onclick="openTab(event, 'settings-tab')">Settings</button>
    </div>
    
    <button id="dark-mode-toggle" title="Toggle Dark Mode">${settings && settings.theme === 'dark' ? '☀️' : '🌙'}</button>
    
    <!-- Time Tracking Tab -->
    <div id="time-tracking-tab" class="tab-content" style="display: block;">
        <div class="file-operations">
            <h2>Data Management</h2>
            <p>Save your data to a file that you can store in Google Drive or import later.</p>
            <div class="filter-row">
                <button id="export-data" class="blue-btn">Export Data File</button>
                <button id="import-data" class="blue-btn">Import Data File</button>
                <button id="export-csv" class="blue-btn">Export CSV</button>
                <input type="file" id="file-input" style="display:none;">
            </div>
        </div>
        
        <div class="filter-section">
            <h2>Filter Entries</h2>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="date-range">Date Range:</label>
                    <select id="date-range" class="filter-select">
                        <option value="all">All Time</option>
                        <option value="today">Today</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="this-week">This Week</option>
                        <option value="last-week">Last Week</option>
                        <option value="this-month">This Month</option>
                        <option value="last-month">Last Month</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div class="filter-group" id="custom-date-range" style="display: none;">
                    <div style="display: flex; gap: 10px;">
                        <div style="flex: 1;">
                            <label for="date-from">From:</label>
                            <input type="date" id="date-from">
                        </div>
                        <div style="flex: 1;">
                            <label for="date-to">To:</label>
                            <input type="date" id="date-to">
                        </div>
                    </div>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="filter-client">Client:</label>
                    <select id="filter-client" class="filter-select">
                        <option value="all">All Clients</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filter-project">Project:</label>
                    <select id="filter-project" class="filter-select">
                        <option value="all">All Projects</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button id="apply-filters" class="blue-btn">Apply Filters</button>
                    <button id="clear-filters">Clear Filters</button>
                </div>
            </div>
        </div>
        
        <!-- Timer Section -->
        <div class="timer-container">
            <h2>Timer</h2>
            <div class="timer-display" id="timer-display">00:00:00</div>
            <div class="filter-row">
                <input type="text" id="timer-description" placeholder="What are you working on?">
                <select id="timer-project">
                    <option value="">Select Project (optional)</option>
                </select>
                <select id="timer-client">
                    <option value="">Select Client (optional)</option>
                </select>
                <select id="timer-rate">
                    <option value="350">Standard Rate ($350)</option>
                </select>
            </div>
            <div class="filter-row">
                <button id="start-timer" class="blue-btn">Start Timer</button>
                <button id="pause-timer" style="display: none;">Pause</button>
                <button id="resume-timer" style="display: none;">Resume</button>
                <button id="stop-timer" style="display: none;">Stop & Save</button>
                <button id="cancel-timer" style="display: none;">Cancel</button>
            </div>
        </div>
        
        <div class="time-entry">
            <h2 id="form-title">Record Time Manually</h2>
            <div>
                <label for="date">Date:</label>
                <input type="date" id="date" required>
            </div>
            <div>
                <label for="description">Description:</label>
                <input type="text" id="description" placeholder="Description of work" required>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="client">Client:</label>
                    <input type="text" id="client" placeholder="Client name" list="clients-list">
                    <datalist id="clients-list"></datalist>
                </div>
                <div class="filter-group">
                    <label for="project">Project:</label>
                    <input type="text" id="project" placeholder="Project name" list="projects-list">
                    <datalist id="projects-list"></datalist>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="hours">Hours:</label>
                    <input type="number" id="hours" step="0.25" min="0.25" max="24" placeholder="Hours worked" required>
                </div>
                <div class="filter-group">
                    <label for="rate">Hourly Rate ($):</label>
                    <input type="number" id="rate" value="350" min="1">
                </div>
            </div>
            <input type="hidden" id="edit-id" value="">
            <div class="filter-row">
                <button id="add-entry">Add Entry</button>
                <button id="update-entry" style="display: none;">Update Entry</button>
                <button id="cancel-edit" class="blue-btn" style="display: none;">Cancel</button>
                <button id="save-recurring" class="blue-btn">Save as Recurring</button>
            </div>
        </div>
        
        <!-- Recurring Entries Section -->
        <div class="time-entry" style="margin-top: 20px;">
            <h2>Recurring Entries</h2>
            <div id="recurring-entries-container">
                <!-- Recurring entries will be displayed here -->
                <p id="no-recurring" style="font-style: italic;">No saved recurring entries yet.</p>
            </div>
        </div>
        
        <!-- Expenses Section -->
        <div class="expense-section">
            <h2>Expenses</h2>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="expense-date">Date:</label>
                    <input type="date" id="expense-date" required>
                </div>
                <div class="filter-group">
                    <label for="expense-description">Description:</label>
                    <input type="text" id="expense-description" placeholder="Expense description" required>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="expense-amount">Amount ($):</label>
                    <input type="number" id="expense-amount" step="0.01" min="0.01" placeholder="Amount" required>
                </div>
                <div class="filter-group">
                    <label for="expense-client">Bill to Client:</label>
                    <input type="text" id="expense-client" placeholder="Client name" list="clients-list-expense">
                    <datalist id="clients-list-expense"></datalist>
                </div>
                <div class="filter-group">
                    <label for="expense-project">Project:</label>
                    <input type="text" id="expense-project" placeholder="Project name" list="projects-list-expense">
                    <datalist id="projects-list-expense"></datalist>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="expense-receipt">Receipt (optional):</label>
                    <input type="file" id="expense-receipt" accept="image/*,.pdf">
                </div>
                <div class="filter-group" style="align-self: flex-end;">
                    <button id="add-expense" class="blue-btn">Add Expense</button>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <h3>Expenses List</h3>
                <table id="expenses-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Client</th>
                            <th>Project</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="expenses-body"></tbody>
                </table>
                
                <div class="summary">
                    <p><strong>Total Expenses:</strong> $<span id="total-expenses">0.00</span></p>
                </div>
            </div>
        </div>

        <div class="time-log">
            <h2>Time Log</h2>
            <table id="entries-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Description</th>
                        <th>Client</th>
                        <th>Project</th>
                        <th>Hours</th>
                        <th>Rate</th>
                        <th>Amount</th>
                        <th>USD RATE</th>
                        <th>AMOUNT (USD)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="entries-body"></tbody>
            </table>
            
            <div class="summary">
                <p><strong>Filtered Hours:</strong> <span id="filtered-hours">0</span></p>
                <p><strong>Filtered Amount:</strong> $<span id="filtered-amount">0.00</span></p>
                <p><strong>Total Hours:</strong> <span id="total-hours">0</span></p>
                <p><strong>Total Amount:</strong> $<span id="total-amount">0.00</span></p>
            </div>
        </div>
    </div>
    
    <!-- Dashboard Tab -->
    <div id="dashboard-tab" class="tab-content">
        <h2>Dashboard</h2>
        
        <div class="filter-section">
            <h3>Dashboard Filters</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="dash-date-range">Date Range:</label>
                    <select id="dash-date-range" class="filter-select">
                        <option value="all">All Time</option>
                        <option value="this-week">This Week</option>
                        <option value="last-week">Last Week</option>
                        <option value="this-month">This Month</option>
                        <option value="last-month">Last Month</option>
                        <option value="this-year">This Year</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div class="filter-group" id="dash-custom-date-range" style="display: none;">
                    <div style="display: flex; gap: 10px;">
                        <div style="flex: 1;">
                            <label for="dash-date-from">From:</label>
                            <input type="date" id="dash-date-from">
                        </div>
                        <div style="flex: 1;">
                            <label for="dash-date-to">To:</label>
                            <input type="date" id="dash-date-to">
                        </div>
                    </div>
                </div>
                <div class="filter-group">
                    <label for="dash-client">Client:</label>
                    <select id="dash-client" class="filter-select">
                        <option value="all">All Clients</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="dash-project">Project:</label>
                    <select id="dash-project" class="filter-select">
                        <option value="all">All Projects</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button id="refresh-dashboard" class="blue-btn">Refresh Dashboard</button>
                </div>
            </div>
        </div>
        
        <div class="stats-row">
            <div class="stats-card">
                <div class="stats-label">Total Hours</div>
                <div id="dash-total-hours" class="stats-value">0</div>
            </div>
            <div class="stats-card">
                <div class="stats-label">Total Revenue</div>
                <div id="dash-total-revenue" class="stats-value">$0</div>
            </div>
            <div class="stats-card">
                <div class="stats-label">Weekly Average Hours</div>
                <div id="dash-avg-hours" class="stats-value">0</div>
            </div>
            <div class="stats-card">
                <div class="stats-label">Weekly Average Revenue</div>
                <div id="dash-avg-revenue" class="stats-value">$0</div>
            </div>
        </div>
        
        <div class="stats-row">
            <div class="stats-card">
                <div class="stats-label">Hourly Rate (Average)</div>
                <div id="dash-avg-rate" class="stats-value">$0</div>
            </div>
            <div class="stats-card">
                <div class="stats-label">Total Expenses</div>
                <div id="dash-total-expenses" class="stats-value">$0</div>
            </div>
            <div class="stats-card">
                <div class="stats-label">Net Income</div>
                <div id="dash-net-income" class="stats-value">$0</div>
            </div>
            <div class="stats-card">
                <div class="stats-label">Tracked Days (Ratio)</div>
                <div id="dash-days-tracked" class="stats-value">0/0 (0%)</div>
            </div>
        </div>
        
        <div class="chart-row">
            <div class="chart-column">
                <div class="chart-container">
                    <h3>Hours by Day</h3>
                    <canvas id="hours-chart"></canvas>
                </div>
            </div>
            <div class="chart-column">
                <div class="chart-container">
                    <h3>Revenue by Day</h3>
                    <canvas id="revenue-chart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="chart-row">
            <div class="chart-column">
                <div class="chart-container">
                    <h3>Monthly Summary</h3>
                    <canvas id="monthly-chart"></canvas>
                </div>
            </div>
            <div class="chart-column">
                <div class="chart-container">
                    <h3>Distribution by Client</h3>
                    <canvas id="client-chart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="chart-row">
            <div class="chart-column">
                <div class="chart-container">
                    <h3>Distribution by Project</h3>
                    <canvas id="project-chart"></canvas>
                </div>
            </div>
            <div class="chart-column">
                <div class="chart-container">
                    <h3>Hours by Day of Week</h3>
                    <canvas id="weekday-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Invoice Tab -->
    <div id="invoice-tab" class="tab-content">
        <div class="invoice-generator">
            <h2>Invoice Generator</h2>
            
            <div class="filter-section">
                <h3>Invoice Details</h3>
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="invoice-client">Client:</label>
                        <select id="invoice-client">
                            <option value="">Select Client</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="invoice-project">Project (Optional):</label>
                        <select id="invoice-project">
                            <option value="all">All Projects</option>
                        </select>
                    </div>
                </div>
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="invoice-date-range">Date Range:</label>
                        <select id="invoice-date-range">
                            <option value="this-month">This Month</option>
                            <option value="last-month">Last Month</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    <div class="filter-group" id="invoice-custom-date-range" style="display: none;">
                        <div style="display: flex; gap: 10px;">
                            <div style="flex: 1;">
                                <label for="invoice-date-from">From:</label>
                                <input type="date" id="invoice-date-from">
                            </div>
                            <div style="flex: 1;">
                                <label for="invoice-date-to">To:</label>
                                <input type="date" id="invoice-date-to">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="include-expenses">Include Expenses:</label>
                        <select id="include-expenses">
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="invoice-number">Invoice Number:</label>
                        <input type="text" id="invoice-number" placeholder="Invoice #">
                    </div>
                </div>
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="invoice-date">Invoice Date:</label>
                        <input type="date" id="invoice-date">
                    </div>
                    <div class="filter-group">
                        <label for="payment-terms">Payment Terms:</label>
                        <input type="text" id="payment-terms" placeholder="e.g., Net 30" value="Net 30">
                    </div>
                </div>
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="invoice-notes">Notes/Additional Information:</label>
                        <textarea id="invoice-notes" rows="3" placeholder="Any additional notes or payment instructions"></textarea>
                    </div>
                </div>
                <div class="filter-row">
                    <button id="generate-invoice" class="blue-btn">Generate Invoice</button>
                    <button id="view-invoice-entries">View Entries to be Included</button>
                </div>
                <div class="filter-row" id="invoice-toggles-row" style="border:2px solid red;background:#fffbe6;">
  <div style="color:#b00;font-weight:bold;margin-bottom:4px;">[DEBUG] Invoice Toggles Row Rendered</div>
                    <div class="filter-group">
                        <label class="toggle-label" for="invoice-currency-toggle">Invoice Currency:</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="invoice-currency-toggle">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label" id="currency-toggle-label">AUD</span>
                        </label>
                    </div>
                    <div class="filter-group">
                        <label class="toggle-label" for="invoice-invoiced-toggle">Invoiced:</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="invoice-invoiced-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="filter-group">
                        <label class="toggle-label" for="invoice-paid-toggle">Paid:</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="invoice-paid-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
<script>
  // DEBUG: Check if toggles are present and visible
  window.addEventListener('DOMContentLoaded', function() {
    const row = document.getElementById('invoice-toggles-row');
    if (row) {
      const style = window.getComputedStyle(row);
      console.log('[DEBUG] invoice-toggles-row found. Display:', style.display, 'Visibility:', style.visibility, 'Opacity:', style.opacity);
    } else {
      console.log('[DEBUG] invoice-toggles-row NOT found');
    }
  });
  // Invoice Currency Toggle
  const currencyToggle = document.getElementById('invoice-currency-toggle');
  const currencyLabel = document.getElementById('currency-toggle-label');
  if (currencyToggle && currencyLabel) {
    currencyToggle.addEventListener('change', () => {
      currencyLabel.textContent = currencyToggle.checked ? 'USD' : 'AUD';
      // TODO: Trigger invoice recalculation and UI update here
    });
  }
  // Invoice Status Toggles (prepare for persistence logic)
  const invoicedToggle = document.getElementById('invoice-invoiced-toggle');
  const paidToggle = document.getElementById('invoice-paid-toggle');
  if (invoicedToggle) {
    invoicedToggle.addEventListener('change', (e) => {
      // TODO: Persist 'invoiced' status to Supabase
      console.log('Invoiced status:', e.target.checked);
    });
  }
  if (paidToggle) {
    paidToggle.addEventListener('change', (e) => {
      // TODO: Persist 'paid' status to Supabase
      console.log('Paid status:', e.target.checked);
    });
  }
</script>
            <div id="invoice-entries-preview" style="display: none; margin-top: 20px;">
                <h3>Entries to be Included</h3>
                <table id="invoice-entries-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Hours</th>
                            <th>Rate</th>
                            <th>Amount</th>
                            <th>Include</th>
                        </tr>
                    </thead>
                    <tbody id="invoice-entries-body"></tbody>
                </table>
                
                <h3>Expenses to be Included</h3>
                <table id="invoice-expenses-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Include</th>
                        </tr>
                    </thead>
                    <tbody id="invoice-expenses-body"></tbody>
                </table>
                
                <div class="summary">
                    <p><strong>Total Hours:</strong> <span id="invoice-total-hours">0</span></p>
                    <p><strong>Total Hours Amount:</strong> $<span id="invoice-total-amount">0.00</span></p>
                    <p><strong>Total Expenses:</strong> $<span id="invoice-total-expenses">0.00</span></p>
                    <p><strong>Grand Total:</strong> $<span id="invoice-grand-total">0.00</span></p>
                </div>
            </div>
            
            <div class="filter-row" style="margin-top: 20px;">
                <button id="print-invoice" style="display: none;">Print Invoice</button>
                <button id="save-invoice-pdf" class="blue-btn" style="display: none;">Save Invoice as PDF</button>
                <button id="export-invoice-excel" class="blue-btn" style="display: none;">Export to Excel</button>
                <button id="mark-as-paid" class="blue-btn" style="display: none;">Mark as Paid</button>
            </div>
        </div>

        <div id="invoice-preview" class="invoice" style="display: none;"></div>
        
        <div class="invoice-history" style="margin-top: 30px; display: none;">
            <h3>Invoice History</h3>
            <table id="invoice-history-table">
                <thead>
                    <tr>
                        <th>Invoice #</th>
                        <th>Client</th>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="invoice-history-body"></tbody>
            </table>
        </div>
    </div>

    <!-- Reports Tab -->
    <div id="reports-tab" class="tab-content">
        <h2>Reports</h2>
        
        <div class="filter-section">
            <h3>Report Settings</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="report-type">Report Type:</label>
                    <select id="report-type">
                        <option value="summary">Summary Report</option>
                        <option value="detailed">Detailed Time Report</option>
                        <option value="client">Client Report</option>
                        <option value="project">Project Report</option>
                        <option value="expense">Expense Report</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="report-date-range">Date Range:</label>
                    <select id="report-date-range">
                        <option value="this-month">This Month</option>
                        <option value="last-month">Last Month</option>
                        <option value="this-year">This Year</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div class="filter-group" id="report-custom-date-range" style="display: none;">
                    <div style="display: flex; gap: 10px;">
                        <div style="flex: 1;">
                            <label for="report-date-from">From:</label>
                            <input type="date" id="report-date-from">
                        </div>
                        <div style="flex: 1;">
                            <label for="report-date-to">To:</label>
                            <input type="date" id="report-date-to">
                        </div>
                    </div>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="report-client">Client:</label>
                    <select id="report-client">
                        <option value="all">All Clients</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="report-project">Project:</label>
                    <select id="report-project">
                        <option value="all">All Projects</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button id="generate-report" class="blue-btn">Generate Report</button>
                    <button id="export-report" class="blue-btn">Export Report</button>
                </div>
            </div>
        </div>
        
        <div id="report-container" style="margin-top: 20px;">
            <!-- Report will be displayed here -->
            <p id="no-report" style="font-style: italic; text-align: center;">Select report settings and click "Generate Report" to view your data.</p>
        </div>
    </div>
    
    <!-- Settings Tab -->
    <div id="settings-tab" class="tab-content">
        <h2>Settings</h2>
        
        <div class="filter-section">
            <h3>Rate Templates</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="rate-name">Rate Name:</label>
                    <input type="text" id="rate-name" placeholder="e.g., Standard, Rush, Design, etc.">
                </div>
                <div class="filter-group">
                    <label for="rate-amount">Hourly Rate ($):</label>
                    <input type="number" id="rate-amount" min="1" placeholder="Hourly rate">
                </div>
                <div class="filter-group">
                    <button id="add-rate" class="blue-btn">Add Rate</button>
                </div>
            </div>
            <div id="rates-container">
                <!-- Rate templates will be displayed here -->
            </div>
        </div>
        
        <div class="filter-section">
            <h3>Default Settings</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="default-rate">Default Hourly Rate:</label>
                    <select id="default-rate">
                        <option value="350">Standard Rate ($350)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="default-payment-terms">Default Payment Terms:</label>
                    <input type="text" id="default-payment-terms" value="Net 30">
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="your-name">Your Name/Business Name:</label>
                    <input type="text" id="your-name" placeholder="Your name or business name">
                </div>
                <div class="filter-group">
                    <label for="your-email">Your Email:</label>
                    <input type="email" id="your-email" placeholder="Your email address">
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="your-address">Your Address:</label>
                    <textarea id="your-address" rows="3" placeholder="Your address for invoices"></textarea>
                </div>
                <div class="filter-group">
                    <label for="payment-instructions">Payment Instructions:</label>
                    <textarea id="payment-instructions" rows="3" placeholder="Default payment instructions for invoices"></textarea>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="banking-details">Banking Details:</label>
                    <textarea id="banking-details" rows="4" placeholder="Bank name, account number, routing number, SWIFT/BIC code, etc."></textarea>
                </div>
            </div>
            <div class="filter-row">
                <button id="save-settings" class="blue-btn">Save Settings</button>
            </div>
        </div>
        
        <div class="filter-section">
            <h3>Data Management</h3>
            <div class="filter-row">
                <button id="export-all-data" class="blue-btn">Export All Data</button>
                <button id="import-all-data" class="blue-btn">Import Data</button>
                <button id="export-all-csv" class="blue-btn">Export All as CSV</button>
                <button id="export-all-excel" class="blue-btn">Export All as Excel</button>
            </div>
            <div class="filter-row">
                
            </div>
        </div>
        
        <div class="filter-section">
            <h3>Display Settings</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="theme-selection">Theme:</label>
                    <select id="theme-selection">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="auto">Auto (System Preference)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="date-format">Date Format:</label>
                    <select id="date-format">
                        <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                        <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                        <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="currency-format">Currency:</label>
                    <select id="currency-format">
                        <option value="USD">USD ($)</option>
                        <option value="EUR">EUR (€)</option>
                        <option value="GBP">GBP (£)</option>
                        <option value="CAD">CAD ($)</option>
                        <option value="AUD">AUD ($)</option>
                    </select>
                </div>
            </div>
            <div class="filter-row">
                <button id="save-display-settings" class="blue-btn">Save Display Settings</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize data from localStorage or empty array
        let timeEntries = JSON.parse(localStorage.getItem('timeEntries')) || [];
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        let recurringEntries = JSON.parse(localStorage.getItem('recurringEntries')) || [];
        let invoices = JSON.parse(localStorage.getItem('invoices')) || [];
        let rates = JSON.parse(localStorage.getItem('rates')) || [
            { id: 1, name: 'Standard Rate', amount: 350 }
        ];
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            defaultRate: 350,
            defaultPaymentTerms: 'Net 30',
            name: '',
            email: '',
            address: '',
            paymentInstructions: '',
            theme: 'light',
            dateFormat: 'MM/DD/YYYY',
            currency: 'USD'
        };
        
        // Apply theme if set in localStorage
        if (settings.theme === 'dark' || 
           (settings.theme === 'auto' && 
            window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.body.classList.add('dark-mode');
        }
        
        let hourlyRate = 350; // Default rate

        // Charts
        let hoursChart, revenueChart, monthlyChart;

        function showConfirmToast(message) {
            return new Promise(resolve => {
                const notification = document.createElement('div');
                notification.className = 'notification warning';

                const text = document.createElement('span');
                text.textContent = message;

                const confirmBtn = document.createElement('button');
                confirmBtn.className = 'confirm-btn';
                confirmBtn.textContent = 'Delete';

                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'cancel-btn';
                cancelBtn.textContent = 'Cancel';

                notification.appendChild(text);
                notification.appendChild(confirmBtn);
                notification.appendChild(cancelBtn);

                let handled = false;
                const cleanup = (result) => {
                    if (handled) return;
                    handled = true;
                    notification.style.opacity = '0';
                    setTimeout(() => notification.remove(), 300);
                    resolve(result);
                };

                confirmBtn.addEventListener('click', () => cleanup(true));
                cancelBtn.addEventListener('click', () => cleanup(false));

                setTimeout(() => cleanup(false), 5000);

                document.body.appendChild(notification);
            });
        }

        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();
        document.getElementById('invoice-date').valueAsDate = new Date();

        // Initialize table with existing entries
        updateTable();
        updateSummary();

        // Add event listeners
        document.getElementById('add-entry').addEventListener('click', addTimeEntry);
        document.getElementById('update-entry').addEventListener('click', updateTimeEntry);
        document.getElementById('cancel-edit').addEventListener('click', cancelEdit);
        document.getElementById('generate-invoice').addEventListener('click', generateInvoice);
        document.getElementById('print-invoice').addEventListener('click', () => window.print());
        document.getElementById('export-data').addEventListener('click', exportData);
        document.getElementById('import-data').addEventListener('click', () => document.getElementById('file-input').click());
        document.getElementById('file-input').addEventListener('change', importData);
        document.getElementById('save-invoice-pdf').addEventListener('click', () => {
            alert('To save as PDF: Use your browser\'s print feature (Ctrl+P or Cmd+P) and select "Save as PDF" as the destination.');
            window.print();
        });
        document.getElementById('refresh-dashboard').addEventListener('click', updateDashboard);
        
        // Dark mode toggle
        document.getElementById('dark-mode-toggle').addEventListener('click', toggleDarkMode);
        
        function toggleDarkMode() {
            const isDark = document.body.classList.toggle('dark-mode');
            
            // Update settings
            settings.theme = isDark ? 'dark' : 'light';
            localStorage.setItem('settings', JSON.stringify(settings));
            
            // Update icon
            document.getElementById('dark-mode-toggle').textContent = isDark ? '☀️' : '🌙';
            
            // Rebuild charts with new theme
            if (document.getElementById('dashboard-tab').style.display === 'block') {
                updateDashboard();
            }
        }
        
        // Add time entry
        function addTimeEntry() {
            const dateInput = document.getElementById('date');
            const descriptionInput = document.getElementById('description');
            const hoursInput = document.getElementById('hours');
            const rateInput = document.getElementById('rate');
            
            // Validate inputs
            if (!dateInput.value || !descriptionInput.value || !hoursInput.value || !rateInput.value) {
                alert('Please fill in all fields');
                return;
            }
            
            // Get values
            const date = dateInput.value;
            const description = descriptionInput.value;
            const hours = parseFloat(hoursInput.value);
            const rate = parseFloat(rateInput.value);
            const amount = hours * rate;
            
            // Add to entries array
            timeEntries.push({
                id: Date.now(), // unique ID for entry
                date,
                description,
                hours,
                rate,
                amount
            });
            
            // Save to localStorage
            localStorage.setItem('timeEntries', JSON.stringify(timeEntries));
            
            // Update the UI
            updateTable();
            updateSummary();
            
            // Clear form (except rate)
            descriptionInput.value = '';
            hoursInput.value = '';
        }
        
        // Update the entries table
        function updateTable() {
            const tableBody = document.getElementById('entries-body');
            tableBody.innerHTML = '';
            
            // Sort entries by date (newest first)
            const sortedEntries = [...timeEntries].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            sortedEntries.forEach(entry => {
                const row = document.createElement('tr');
                
                const formatDate = new Date(entry.date).toLocaleDateString();
                
                row.innerHTML = `
                    <td>${formatDate}</td>
                    <td>${entry.description}</td>
                    <td>${entry.hours.toFixed(2)}</td>
                    <td>$${entry.rate.toFixed(2)}</td>
                    <td>$${entry.amount.toFixed(2)}</td>
                    <td>
                        <button class="edit-btn blue-btn" data-id="${entry.id}" style="margin-right: 5px; padding: 5px 10px;">✏️</button>
                        <button class="delete-btn" data-id="${entry.id}" style="padding: 5px 10px;">🗑️</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add delete and edit event listeners
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', deleteEntry);
            });
            
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', editEntry);
            });
        }
        
        // Update summary
        function updateSummary() {
            const totalHours = timeEntries.reduce((sum, entry) => sum + entry.hours, 0);
            const totalAmount = timeEntries.reduce((sum, entry) => sum + entry.amount, 0);
            
            document.getElementById('total-hours').textContent = totalHours.toFixed(2);
            document.getElementById('total-amount').textContent = totalAmount.toFixed(2);
        }
        
        // Edit an entry
        function editEntry(e) {
            const id = parseInt(e.target.getAttribute('data-id'));
            const entry = timeEntries.find(entry => entry.id === id);
            
            if (!entry) return;
            
            // Populate the form with entry data
            document.getElementById('date').value = entry.date;
            document.getElementById('description').value = entry.description;
            document.getElementById('hours').value = entry.hours;
            document.getElementById('rate').value = entry.rate;
            document.getElementById('edit-id').value = entry.id;
            
            // Show update buttons and hide add button
            document.getElementById('add-entry').style.display = 'none';
            document.getElementById('update-entry').style.display = 'inline-block';
            document.getElementById('cancel-edit').style.display = 'inline-block';
            
            // Change form title
            document.getElementById('form-title').textContent = 'Edit Time Entry';
            
            // Scroll to the form
            document.querySelector('.time-entry').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Update an entry
        function updateTimeEntry() {
            const dateInput = document.getElementById('date');
            const descriptionInput = document.getElementById('description');
            const hoursInput = document.getElementById('hours');
            const rateInput = document.getElementById('rate');
            const editId = parseInt(document.getElementById('edit-id').value);
            
            // Validate inputs
            if (!dateInput.value || !descriptionInput.value || !hoursInput.value || !rateInput.value) {
                alert('Please fill in all fields');
                return;
            }
            
            // Get values
            const date = dateInput.value;
            const description = descriptionInput.value;
            const hours = parseFloat(hoursInput.value);
            const rate = parseFloat(rateInput.value);
            const amount = hours * rate;
            
            // Find the entry index
            const entryIndex = timeEntries.findIndex(entry => entry.id === editId);
            
            if (entryIndex === -1) {
                alert('Error: Entry not found!');
                return;
            }
            
            // Update the entry
            timeEntries[entryIndex] = {
                ...timeEntries[entryIndex],
                date,
                description,
                hours,
                rate,
                amount
            };
            
            // Save to localStorage
            localStorage.setItem('timeEntries', JSON.stringify(timeEntries));
            
            // Update the UI
            updateTable();
            updateSummary();
            
            // Reset the form
            cancelEdit();
        }
        
        // Cancel edit mode
        function cancelEdit() {
            // Clear form
            document.getElementById('description').value = '';
            document.getElementById('hours').value = '';
            document.getElementById('edit-id').value = '';
            
            // Reset date to today
            document.getElementById('date').valueAsDate = new Date();
            
            // Show add button and hide update buttons
            document.getElementById('add-entry').style.display = 'inline-block';
            document.getElementById('update-entry').style.display = 'none';
            document.getElementById('cancel-edit').style.display = 'none';
            
            // Reset form title
            document.getElementById('form-title').textContent = 'Record Time';
        }
        
        // Delete an entry
        async function deleteEntry(e) {
            const id = parseInt(e.target.getAttribute('data-id'));

            const confirmed = await showConfirmToast('Are you sure you want to delete this entry?');
            if (!confirmed) {
                return;
            }

            timeEntries = timeEntries.filter(entry => entry.id !== id);
            localStorage.setItem('timeEntries', JSON.stringify(timeEntries));

            updateTable();
            updateSummary();
        }
        
        // Generate invoice
        function generateInvoice() {
            const clientName = document.getElementById('client-name').value;
            const invoiceNumber = document.getElementById('invoice-number').value;
            const invoiceDate = document.getElementById('invoice-date').value;
            const paymentTerms = document.getElementById('payment-terms').value;
            
            if (!clientName || !invoiceNumber || !invoiceDate) {
                alert('Please fill in client name, invoice number, and invoice date');
                return;
            }
            
            const invoicePreview = document.getElementById('invoice-preview');
            const formattedDate = new Date(invoiceDate).toLocaleDateString();
            
            // Calculate totals
            const totalHours = timeEntries.reduce((sum, entry) => sum + entry.hours, 0);
            const totalAmount = timeEntries.reduce((sum, entry) => sum + entry.amount, 0);
            
            // Generate invoice HTML
            let invoiceHtml = `
                <div style="text-align: right; margin-bottom: 20px;">
                    <h2>INVOICE</h2>
                    <p><strong>Invoice #:</strong> ${invoiceNumber}</p>
                    <p><strong>Date:</strong> ${formattedDate}</p>
                    <p><strong>Terms:</strong> ${paymentTerms}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3>Bill To:</h3>
                    <p>${clientName}</p>
                </div>
                
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Date</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Description</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Hours</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Rate</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // Add entries to invoice - sort by date
            const sortedEntries = [...timeEntries].sort((a, b) => 
                new Date(a.date) - new Date(b.date)
            );
            
            sortedEntries.forEach(entry => {
                const entryDate = new Date(entry.date).toLocaleDateString();
                invoiceHtml += `
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">${entryDate}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${entry.description}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${entry.hours.toFixed(2)}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">$${entry.rate.toFixed(2)}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">$${entry.amount.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            // Add totals to invoice
            invoiceHtml += `
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="2" style="border: 1px solid #ddd; padding: 8px;"></td>
                            <td style="border: 1px solid #ddd; padding: 8px;"><strong>${totalHours.toFixed(2)}</strong></td>
                            <td style="border: 1px solid #ddd; padding: 8px;"><strong>Total:</strong></td>
                            <td style="border: 1px solid #ddd; padding: 8px;"><strong>$${totalAmount.toFixed(2)}</strong></td>
                        </tr>
                    </tfoot>
                </table>
                
                <div style="margin-top: 40px;">
                    <p><strong>Payment Instructions:</strong></p>
                    <p>Please make payment within ${paymentTerms} days of the invoice date.</p>
                </div>
            `;
            
            invoicePreview.innerHTML = invoiceHtml;
            invoicePreview.style.display = 'block';
            document.getElementById('print-invoice').style.display = 'inline-block';
            document.getElementById('save-invoice-pdf').style.display = 'inline-block';
        }
        
        // Export data to a file
        function exportData() {
            // Create data object with all necessary information
            const dataToExport = {
                timeEntries,
                version: '1.0',
                exportDate: new Date().toISOString()
            };
            
            // Convert to JSON
            const jsonData = JSON.stringify(dataToExport, null, 2);
            
            // Create blob and download link
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // Create a download link and click it
            const a = document.createElement('a');
            a.href = url;
            a.download = `time-tracker-data-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
        
        // Import data from a file
        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    // Validate the data
                    if (!importedData.timeEntries || !Array.isArray(importedData.timeEntries)) {
                        throw new Error('Invalid data format');
                    }
                    
                    // Ask for confirmation to replace existing data
                    if (timeEntries.length > 0) {
                        if (!confirm('This will replace your existing data. Continue?')) {
                            return;
                        }
                    }
                    
                    // Import the data
                    timeEntries = importedData.timeEntries;
                    localStorage.setItem('timeEntries', JSON.stringify(timeEntries));
                    
                    // Update the UI
                    updateTable();
                    updateSummary();
                    
                    alert('Data imported successfully!');
                } catch (error) {
                    alert('Error importing data: ' + error.message);
                }
            };
            
            reader.readAsText(file);
            // Reset the file input
            e.target.value = '';
        }
        
        // Tab functionality
        function openTab(evt, tabName) {
            // Hide all tab content
            const tabContent = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContent.length; i++) {
                tabContent[i].style.display = "none";
            }
            
            // Remove active class from all tab buttons
            const tabButtons = document.getElementsByClassName("tab-button");
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].className = tabButtons[i].className.replace(" active", "");
            }
            
            // Show the current tab and add active class to the button
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
            
            // Initialize dashboard if it's the dashboard tab
            if (tabName === 'dashboard-tab') {
                updateDashboard();
            }
        }
        
        // Update dashboard charts and statistics
        function updateDashboard() {
            // Update statistics
            const totalHours = timeEntries.reduce((sum, entry) => sum + entry.hours, 0);
            const totalRevenue = timeEntries.reduce((sum, entry) => sum + entry.amount, 0);
            
            document.getElementById('dash-total-hours').textContent = totalHours.toFixed(2);
            document.getElementById('dash-total-revenue').textContent = '$' + totalRevenue.toFixed(2);
            
            // Process data for charts
            const weeklyData = getWeeklyData();
            const monthlyData = getMonthlyData();
            
            // Calculate averages
            let avgWeeklyHours = 0;
            let avgWeeklyRevenue = 0;
            
            if (weeklyData.weeks.length > 0) {
                avgWeeklyHours = weeklyData.hours.reduce((a, b) => a + b, 0) / weeklyData.weeks.length;
                avgWeeklyRevenue = weeklyData.revenue.reduce((a, b) => a + b, 0) / weeklyData.weeks.length;
            }
            
            document.getElementById('dash-avg-hours').textContent = avgWeeklyHours.toFixed(2);
            document.getElementById('dash-avg-revenue').textContent = '$' + avgWeeklyRevenue.toFixed(2);
            
            // Update charts
            updateHoursChart(weeklyData);
            updateRevenueChart(weeklyData);
            updateMonthlyChart(monthlyData);
        }
        
        // Get weekly data from time entries
        function getWeeklyData() {
            // Sort entries by date
            const sortedEntries = [...timeEntries].sort((a, b) => 
                new Date(a.date) - new Date(b.date)
            );
            
            if (sortedEntries.length === 0) {
                return { weeks: [], hours: [], revenue: [] };
            }
            
            // Group entries by week
            const weeklyData = {};
            
            sortedEntries.forEach(entry => {
                const date = new Date(entry.date);
                // Get the monday of this week as a key
                date.setDate(date.getDate() - date.getDay() + 1);
                const weekKey = date.toISOString().slice(0, 10);
                
                if (!weeklyData[weekKey]) {
                    weeklyData[weekKey] = { hours: 0, revenue: 0 };
                }
                
                weeklyData[weekKey].hours += entry.hours;
                weeklyData[weekKey].revenue += entry.amount;
            });
            
            // Convert to arrays for Chart.js
            const weeks = Object.keys(weeklyData);
            const hours = weeks.map(week => weeklyData[week].hours);
            const revenue = weeks.map(week => weeklyData[week].revenue);
            
            // Format week labels to be more readable
            const formattedWeeks = weeks.map(week => {
                const date = new Date(week);
                return `${date.toLocaleDateString(undefined, { month: 'short' })} ${date.getDate()}`;
            });
            
            return {
                weeks: formattedWeeks,
                hours,
                revenue
            };
        }
        
        // Get monthly data from time entries
        function getMonthlyData() {
            // Sort entries by date
            const sortedEntries = [...timeEntries].sort((a, b) => 
                new Date(a.date) - new Date(b.date)
            );
            
            if (sortedEntries.length === 0) {
                return { months: [], hours: [], revenue: [] };
            }
            
            // Group entries by month
            const monthlyData = {};
            
            sortedEntries.forEach(entry => {
                const date = new Date(entry.date);
                const monthKey = date.toISOString().slice(0, 7); // YYYY-MM
                
                if (!monthlyData[monthKey]) {
                    monthlyData[monthKey] = { hours: 0, revenue: 0 };
                }
                
                monthlyData[monthKey].hours += entry.hours;
                monthlyData[monthKey].revenue += entry.amount;
            });
            
            // Convert to arrays for Chart.js
            const months = Object.keys(monthlyData);
            const hours = months.map(month => monthlyData[month].hours);
            const revenue = months.map(month => monthlyData[month].revenue);
            
            // Format month labels to be more readable
            const formattedMonths = months.map(month => {
                const date = new Date(month + '-01');
                return date.toLocaleDateString(undefined, { month: 'short', year: 'numeric' });
            });
            
            return {
                months: formattedMonths,
                hours,
                revenue
            };
        }
        
        // Update hours chart
        function updateHoursChart(data) {
            const ctx = document.getElementById('hours-chart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (hoursChart) {
                hoursChart.destroy();
            }
            
            hoursChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.weeks,
                    datasets: [{
                        label: 'Hours per Week',
                        data: data.hours,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Hours'
                            }
                        }
                    }
                }
            });
        }
        
        // Update revenue chart
        function updateRevenueChart(data) {
            const ctx = document.getElementById('revenue-chart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (revenueChart) {
                revenueChart.destroy();
            }
            
            revenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.weeks,
                    datasets: [{
                        label: 'Revenue per Week ($)',
                        data: data.revenue,
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Revenue ($)'
                            }
                        }
                    }
                }
            });
        }
        
        // Update monthly chart
        function updateMonthlyChart(data) {
            const ctx = document.getElementById('monthly-chart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (monthlyChart) {
                monthlyChart.destroy();
            }
            
            monthlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.months,
                    datasets: [
                        {
                            label: 'Hours',
                            data: data.hours,
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Revenue ($)',
                            data: data.revenue,
                            backgroundColor: 'rgba(75, 192, 192, 0.5)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Hours'
                            }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Revenue ($)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }
    </div>
    <script type="module" src="./invoice-toggles.js"></script>
</body>
</html>